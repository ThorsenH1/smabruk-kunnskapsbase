<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2d5a27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SmÃ¥bruk Kunnskapsbase</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¡</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¡</text></svg>">
    <link rel="stylesheet" href="style.css?v=4.0">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-content">
            <div class="login-logo">ğŸ¡</div>
            <h1>SmÃ¥bruk Kunnskapsbase</h1>
            <p class="login-subtitle">Logg inn for Ã¥ synkronisere din kunnskap</p>
            <button id="googleLoginBtn" class="google-login-btn">
                <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Logg inn med Google
            </button>
            <p class="login-hint">Din data lagres privat i skyen</p>
        </div>
    </div>

    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen hidden">
        <div class="splash-content">
            <div class="splash-logo">ğŸ¡</div>
            <div class="splash-spinner"></div>
            <p>Laster inn...</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app hidden">
        <!-- Header -->
        <header class="header">
            <button id="homeBtn" class="header-btn" aria-label="Hjem">ğŸ¡</button>
            <h1 id="farmName">SmÃ¥bruk Kunnskapsbase</h1>
            <button id="syncBtn" class="header-btn" aria-label="Profil">ğŸ‘¤</button>
            <button id="menuBtn" class="header-btn" aria-label="Meny">â˜°</button>
        </header>

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-bar">
                <span class="search-icon">ğŸ”</span>
                <input type="search" id="searchInput" placeholder="SÃ¸k i artikler..." autocomplete="off">
                <button id="clearSearch" class="clear-search hidden">âœ•</button>
            </div>
        </div>

        <!-- Views Container -->
        <main class="main-content">
            <!-- Dashboard View -->
            <section id="dashboardView" class="view active">
                <!-- Stats Cards -->
                <div class="stats-row">
                    <div class="stat-card">
                        <span class="stat-icon">ğŸ“š</span>
                        <span id="totalArticles" class="stat-number">0</span>
                        <span class="stat-label">Artikler</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">ğŸ“</span>
                        <span id="totalCategories" class="stat-number">0</span>
                        <span class="stat-label">Kategorier</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-icon">â­</span>
                        <span id="totalFavorites" class="stat-number">0</span>
                        <span class="stat-label">Favoritter</span>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button id="quickAddBtn" class="quick-btn primary">
                        <span>ğŸ“</span> Ny artikkel
                    </button>
                    <button id="quickContactBtn" class="quick-btn">
                        <span>ğŸ“</span> Kontakter
                    </button>
                    <button id="quickChecklistBtn" class="quick-btn">
                        <span>âœ…</span> Sjekklister
                    </button>
                    <button id="quickEmergencyBtn" class="quick-btn danger">
                        <span>ğŸ†˜</span> NÃ¸dhjelp
                    </button>
                </div>

                <!-- Favorites Section -->
                <section id="favoritesSection" class="section" style="display:none;">
                    <div class="section-header">
                        <h2>â­ Favoritter</h2>
                        <button id="seeAllFavorites" class="see-all-btn">Se alle â†’</button>
                    </div>
                    <div id="favoritesList" class="cards-row"></div>
                </section>

                <!-- Recent Section -->
                <section id="recentSection" class="section" style="display:none;">
                    <div class="section-header">
                        <h2>ğŸ• Nylig sett</h2>
                        <button id="clearRecent" class="see-all-btn">TÃ¸m</button>
                    </div>
                    <div id="recentList" class="cards-row"></div>
                </section>

                <!-- Categories Section -->
                <section class="section">
                    <div class="section-header">
                        <h2>ğŸ“ Kategorier</h2>
                        <button id="manageCategoriesBtn" class="see-all-btn">Administrer</button>
                    </div>
                    <div id="categoryGrid" class="category-grid"></div>
                </section>
            </section>

            <!-- Articles View -->
            <section id="articlesView" class="view">
                <div class="view-header">
                    <button id="backToCategories" class="back-btn">â† Tilbake</button>
                    <div class="view-title">
                        <span id="categoryIcon">ğŸ“</span>
                        <h2 id="categoryTitle">Kategori</h2>
                        <span id="articleCount" class="count-badge">0</span>
                    </div>
                </div>
                <div class="sort-bar">
                    <select id="sortSelect">
                        <option value="alpha">A-Ã…</option>
                        <option value="newest">Nyeste fÃ¸rst</option>
                        <option value="oldest">Eldste fÃ¸rst</option>
                    </select>
                </div>
                <div id="articlesList" class="articles-list"></div>
            </section>

            <!-- Article Detail View -->
            <section id="articleView" class="view">
                <div class="view-header">
                    <button id="backToArticles" class="back-btn">â† Tilbake</button>
                    <div class="article-actions">
                        <button id="favoriteArticleBtn" class="action-btn" aria-label="Favoritt">â­</button>
                        <button id="editArticleBtn" class="action-btn" aria-label="Rediger">âœï¸</button>
                        <button id="deleteArticleBtn" class="action-btn danger" aria-label="Slett">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div id="articleContent" class="article-content"></div>
            </section>

            <!-- Search View -->
            <section id="searchView" class="view">
                <div class="view-header">
                    <button id="backFromSearch" class="back-btn">â† Tilbake</button>
                    <h2>SÃ¸keresultater <span id="searchCount" class="count-badge">0</span></h2>
                </div>
                <div id="searchResults" class="articles-list"></div>
            </section>

            <!-- Contacts View -->
            <section id="contactsView" class="view">
                <div class="view-header">
                    <button id="backFromContacts" class="back-btn">â† Tilbake</button>
                    <h2>ğŸ“ Kontakter</h2>
                    <button id="addContactBtn" class="add-btn">+ Ny</button>
                </div>
                <div id="contactsList" class="contacts-list"></div>
            </section>

            <!-- Checklists View -->
            <section id="checklistsView" class="view">
                <div class="view-header">
                    <button id="backFromChecklists" class="back-btn">â† Tilbake</button>
                    <h2>âœ… Sjekklister</h2>
                    <button id="addChecklistBtn" class="add-btn">+ Ny</button>
                </div>
                <div id="checklistsList" class="checklists-list"></div>
            </section>

            <!-- Checklist Detail View -->
            <section id="checklistDetailView" class="view">
                <div class="view-header">
                    <button id="backFromChecklistDetail" class="back-btn">â† Tilbake</button>
                    <h2 id="checklistTitle">Sjekkliste</h2>
                    <div class="checklist-actions">
                        <button id="resetChecklistBtn" class="action-btn" title="Tilbakestill">ğŸ”„</button>
                        <button id="deleteChecklistBtn" class="action-btn danger" title="Slett">ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="checklist-progress-bar">
                    <div id="checklistProgress" class="progress-fill"></div>
                </div>
                <span id="checklistProgressText" class="progress-text">0/0</span>
                <div id="checklistItems" class="checklist-items"></div>
                <button id="addChecklistItemBtn" class="add-item-btn">+ Legg til punkt</button>
            </section>

            <!-- Emergency View -->
            <section id="emergencyView" class="view">
                <div class="view-header">
                    <button id="backFromEmergency" class="back-btn">â† Tilbake</button>
                    <h2>ğŸ†˜ NÃ¸dhjelp</h2>
                </div>
                <div class="emergency-content">
                    <div class="emergency-card important">
                        <h3>ğŸ“ GÃ¥rdens adresse</h3>
                        <div id="farmAddress" class="address-content">
                            <p class="no-address">Ikke satt opp</p>
                        </div>
                    </div>
                    <div class="emergency-numbers">
                        <h3>ğŸ“ NÃ¸dnumre</h3>
                        <a href="tel:113" class="emergency-btn">ğŸš‘ 113 - Medisinsk</a>
                        <a href="tel:110" class="emergency-btn">ğŸš’ 110 - Brann</a>
                        <a href="tel:112" class="emergency-btn">ğŸš” 112 - Politi</a>
                    </div>
                    <div class="emergency-card">
                        <h3>ğŸ†˜ Mine nÃ¸dkontakter</h3>
                        <div id="emergencyContactList" class="emergency-contacts"></div>
                    </div>
                </div>
            </section>

            <!-- Favorites View -->
            <section id="favoritesView" class="view">
                <div class="view-header">
                    <button id="backFromFavorites" class="back-btn">â† Tilbake</button>
                    <h2>â­ Alle favoritter</h2>
                </div>
                <div id="allFavoritesList" class="articles-list"></div>
            </section>
        </main>

        <!-- FAB -->
        <button id="addBtn" class="fab" aria-label="Legg til artikkel">+</button>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-view="dashboardView">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-label">Hjem</span>
            </button>
            <button class="nav-item" data-view="contactsView">
                <span class="nav-icon">ğŸ“</span>
                <span class="nav-label">Kontakter</span>
            </button>
            <button class="nav-item" data-view="checklistsView">
                <span class="nav-icon">âœ…</span>
                <span class="nav-label">Sjekklister</span>
            </button>
            <button class="nav-item" data-view="favoritesView">
                <span class="nav-icon">â­</span>
                <span class="nav-label">Favoritter</span>
            </button>
        </nav>
    </div>

    <!-- Side Menu -->
    <div id="menuOverlay" class="menu-overlay"></div>
    <nav id="sideMenu" class="side-menu">
        <div class="menu-header">
            <span class="menu-logo">ğŸ¡</span>
            <h2>Meny</h2>
            <button id="closeMenu" class="close-menu-btn">âœ•</button>
        </div>
        <div class="menu-items">
            <button id="menuHome" class="menu-item">ğŸ  Hjem</button>
            <button id="menuSettings" class="menu-item">âš™ï¸ Innstillinger</button>
            <button id="menuCategories" class="menu-item">ğŸ“ Kategorier</button>
            <hr class="menu-divider">
            <button id="menuSync" class="menu-item">â˜ï¸ Sync & Backup</button>
            <button id="menuExport" class="menu-item">ğŸ“¤ Eksporter data</button>
            <button id="menuImport" class="menu-item">ğŸ“¥ Importer data</button>
            <hr class="menu-divider">
            <button id="menuAbout" class="menu-item">â„¹ï¸ Om appen</button>
        </div>
        <div class="menu-footer">
            <p>Versjon 4.0.0</p>
        </div>
    </nav>

    <!-- Article Modal -->
    <div id="articleModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="modalTitle">Ny artikkel</h2>
                <button id="closeArticleModal" class="close-btn">âœ•</button>
            </div>
            <form id="articleForm" class="modal-form">
                <div class="form-group">
                    <label for="articleTitleInput">Tittel *</label>
                    <input type="text" id="articleTitleInput" required placeholder="F.eks. Vedlikeholde traktor">
                </div>
                <div class="form-group">
                    <label for="articleCategory">Kategori *</label>
                    <select id="articleCategory" required></select>
                </div>
                <div class="form-group">
                    <label for="articleTags">Tagger (kommaseparert)</label>
                    <input type="text" id="articleTags" placeholder="F.eks. traktor, diesel, motor">
                </div>
                <div class="form-group">
                    <label for="articleText">Innhold *</label>
                    <textarea id="articleText" rows="8" required placeholder="Skriv innholdet her..."></textarea>
                </div>
                <div class="form-group">
                    <label>Bilder</label>
                    <div class="image-buttons">
                        <button type="button" id="addImageBtn" class="img-btn">ğŸ“· Velg bilde</button>
                        <button type="button" id="cameraBtn" class="img-btn">ğŸ“¸ Ta bilde</button>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" multiple hidden>
                    <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden>
                    <div id="imagePreviewList" class="image-preview-list"></div>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">ğŸ’¾ Lagre</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“ Kategorier</h2>
                <button id="closeCategoryModal" class="close-btn">âœ•</button>
            </div>
            <div id="manageCategoryList" class="category-list"></div>
            <div class="add-category-form">
                <button id="selectEmojiBtn" class="emoji-btn" type="button">ğŸ“</button>
                <input type="text" id="newCategoryName" placeholder="Ny kategori...">
                <button id="addCategoryBtn" class="btn-primary">+ Legg til</button>
            </div>
        </div>
    </div>

    <!-- Emoji Modal -->
    <div id="emojiModal" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>Velg ikon</h2>
                <button class="close-btn" onclick="document.getElementById('emojiModal').classList.remove('active')">âœ•</button>
            </div>
            <div id="emojiGrid" class="emoji-grid"></div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="contactModalTitle">Ny kontakt</h2>
                <button id="closeContactModal" class="close-btn">âœ•</button>
            </div>
            <form id="contactForm" class="modal-form">
                <div class="form-group">
                    <label for="contactName">Navn *</label>
                    <input type="text" id="contactName" required placeholder="F.eks. Ola Nordmann">
                </div>
                <div class="form-group">
                    <label for="contactPhone">Telefon *</label>
                    <input type="tel" id="contactPhone" required placeholder="F.eks. 12345678">
                </div>
                <div class="form-group">
                    <label for="contactCategory">Type</label>
                    <select id="contactCategory">
                        <option value="annet">Annet</option>
                        <option value="handverker">HÃ¥ndverker</option>
                        <option value="leverandor">LeverandÃ¸r</option>
                        <option value="nabo">Nabo</option>
                        <option value="veterinar">VeterinÃ¦r</option>
                        <option value="offentlig">Offentlig</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contactNote">Notat</label>
                    <input type="text" id="contactNote" placeholder="F.eks. RÃ¸rlegger, god pÃ¥ gamle rÃ¸r">
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="contactEmergency">
                    <label for="contactEmergency">ğŸ†˜ Vis som nÃ¸dkontakt</label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">ğŸ’¾ Lagre</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Checklist Modal -->
    <div id="checklistModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ny sjekkliste</h2>
                <button id="closeChecklistModal" class="close-btn">âœ•</button>
            </div>
            <form id="checklistForm" class="modal-form">
                <div class="form-group">
                    <label for="checklistName">Navn *</label>
                    <input type="text" id="checklistName" required placeholder="F.eks. VÃ¥rklargjÃ¸ring traktor">
                </div>
                <div class="form-group">
                    <label for="checklistIcon">Ikon</label>
                    <select id="checklistIcon">
                        <option value="ğŸ“‹">ğŸ“‹ Generell</option>
                        <option value="ğŸšœ">ğŸšœ Maskiner</option>
                        <option value="ğŸ‘">ğŸ‘ Dyr</option>
                        <option value="ğŸŒ±">ğŸŒ± Hage</option>
                        <option value="ğŸ ">ğŸ  Hus</option>
                        <option value="â„ï¸">â„ï¸ Vinter</option>
                        <option value="â˜€ï¸">â˜€ï¸ Sommer</option>
                        <option value="ğŸ‚">ğŸ‚ HÃ¸st</option>
                        <option value="ğŸŒ¸">ğŸŒ¸ VÃ¥r</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">ğŸ“‹ Opprett</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sync Modal -->
    <div id="syncModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â˜ï¸ Sync & Backup</h2>
                <button id="closeSyncModal" class="close-btn">âœ•</button>
            </div>
            <div class="sync-content">
                <p class="sync-info">âœ… Du er logget inn. All data synkroniseres automatisk til skyen.</p>
                <div class="sync-actions">
                    <button id="syncExportBtn" class="btn-secondary">ğŸ“¤ Eksporter backup</button>
                    <button id="syncImportBtn" class="btn-secondary">ğŸ“¥ Importer backup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Innstillinger</h2>
                <button id="closeSettingsModal" class="close-btn">âœ•</button>
            </div>
            <div class="settings-content">
                <div class="form-group">
                    <label for="settingsFarmName">GÃ¥rdens navn</label>
                    <input type="text" id="settingsFarmName" placeholder="F.eks. NordgÃ¥rden">
                </div>
                <div class="form-group">
                    <label for="settingsAddress">Adresse (for nÃ¸dhjelp)</label>
                    <textarea id="settingsAddress" rows="3" placeholder="GÃ¥rdsvegen 1&#10;1234 Bygda"></textarea>
                </div>
                <button id="saveSettingsBtn" class="btn-primary">ğŸ’¾ Lagre innstillinger</button>
                <hr class="settings-divider">
                <div class="danger-zone">
                    <h3>âš ï¸ Faresone</h3>
                    <button id="clearAllDataBtn" class="btn-danger">ğŸ—‘ï¸ Slett all data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â„¹ï¸ Om appen</h2>
                <button id="closeAboutModal" class="close-btn">âœ•</button>
            </div>
            <div class="about-content">
                <div class="about-logo">ğŸ¡</div>
                <h3>SmÃ¥bruk Kunnskapsbase</h3>
                <p class="version">Versjon 4.0.0</p>
                <p class="about-text">
                    En app for Ã¥ samle og bevare kunnskap om ditt smÃ¥bruk. 
                    Lagre tips, oppskrifter, vedlikeholdsrutiner og kontaktinformasjon 
                    â€“ alt pÃ¥ ett sted, tilgjengelig fra alle enheter.
                </p>
                <div class="about-features">
                    <p>âœ… Google-innlogging</p>
                    <p>â˜ï¸ Automatisk skylagring</p>
                    <p>ğŸ“± Fungerer offline</p>
                    <p>ğŸ”’ Privat og sikker</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content small">
            <div class="confirm-content">
                <div id="confirmIcon" class="confirm-icon">âš ï¸</div>
                <h3 id="confirmTitle">Er du sikker?</h3>
                <p id="confirmMessage">Denne handlingen kan ikke angres.</p>
                <div class="confirm-actions">
                    <button id="confirmCancel" class="btn-secondary">Avbryt</button>
                    <button id="confirmOk" class="btn-danger">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox">
        <img src="" alt="Fullskjerm bilde">
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- App -->
    <script src="app.js?v=4.0"></script>
</body>
</html>
